<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consent Mode Sandbox - Debug Fixed</title>

  <!-- Usercentrics CMP -->
  <script id="usercentrics-cmp"
          src="https://app.usercentrics.eu/browser-ui/latest/loader.js"
          data-settings-id="9S0YpI7VSssd1D"
          async>
  </script>

  <!-- Google Tag Manager -->
  <script>
  (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-M75CJDXK');
  </script>
  <!-- End Google Tag Manager -->

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    // Default consent mode
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied'
    });

    // Utility: display consent + tag state
    function displayState() {
      const clarityLoaded = typeof window.clarity === 'function';
      const uetLoaded = typeof window.uetq !== 'undefined';
      const output = document.getElementById('output');
      output.innerHTML = `
        <strong>Detected Tags:</strong><br>
        Clarity loaded: ${clarityLoaded ? '✅ Yes' : '❌ No'}<br>
        UET loaded: ${uetLoaded ? '✅ Yes' : '❌ No'}<br>
        <hr>
        <strong>Last consent action logged to console.</strong>
      `;
      console.log("Clarity loaded:", clarityLoaded, "| UET loaded:", uetLoaded);
    }

    function grantConsent() {
      gtag('consent', 'update', {
        'ad_storage': 'granted',
        'analytics_storage': 'granted'
      });
      document.getElementById('status').textContent = "Consent granted ✅";
      console.log("Consent granted ✅");
      setTimeout(displayState, 1000);
    }

    function denyConsent() {
      gtag('consent', 'update', {
        'ad_storage': 'denied',
        'analytics_storage': 'denied'
      });
      document.getElementById('status').textContent = "Consent denied ❌";
      console.log("Consent denied ❌");
      setTimeout(displayState, 1000);
    }

    function checkConsentState() {
      // We’ll check GTM’s dataLayer snapshot instead
      const consentEvent = dataLayer.find(e => e.event === 'default_consent_update' || e.event === 'consent_update');
      console.log("dataLayer snapshot:", consentEvent);
      displayState();
    }

    window.addEventListener('load', () => setTimeout(displayState, 2000));
  </script>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M75CJDXK"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End GTM (noscript) -->

  <h1>Consent Mode Debug Page</h1>
  <p>This page checks whether consent, UET, and Clarity behave correctly through GTM.</p>

  <button onclick="grantConsent()">Accept All</button>
  <button onclick="denyConsent()">Reject All</button>
  <button onclick="checkConsentState()">Check Consent State</button>

  <p id="status"></p>
  <div id="output" style="background:#f7f7f7; padding:10px; margin-top:15px; border-radius:8px;"></div>

  

</body>
</html>
